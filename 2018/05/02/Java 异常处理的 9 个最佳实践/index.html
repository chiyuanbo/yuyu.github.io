<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Java 异常处理的 9 个最佳实践"><meta name="keywords" content="Java,Code"><meta name="author" content="YB-Chi,undefined"><meta name="copyright" content="YB-Chi"><title>Java 异常处理的 9 个最佳实践 | YB-Chi</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: {"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}"},"path":"search.xml"}
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、在-Finally-清理资源或者使用-Try-With-Resource-特性"><span class="toc-number">1.</span> <span class="toc-text">1、在 Finally 清理资源或者使用 Try-With-Resource 特性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Java-7-的-Try-With-Resource-语法"><span class="toc-number">1.1.</span> <span class="toc-text">Java 7 的 Try-With-Resource 语法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、优先明确异常"><span class="toc-number">2.</span> <span class="toc-text">2、优先明确异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、记录指定的异常"><span class="toc-number">3.</span> <span class="toc-text">3、记录指定的异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、使用描述性消息抛出异常"><span class="toc-number">4.</span> <span class="toc-text">4、使用描述性消息抛出异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5、优先捕获最具体的异常"><span class="toc-number">5.</span> <span class="toc-text">5、优先捕获最具体的异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6、不要捕获-Throwable-类"><span class="toc-number">6.</span> <span class="toc-text">6、不要捕获 Throwable 类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7、不要忽略异常"><span class="toc-number">7.</span> <span class="toc-text">7、不要忽略异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8、不要记录日志和抛出错误"><span class="toc-number">8.</span> <span class="toc-text">8、不要记录日志和抛出错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9、封装好的异常类而不使用"><span class="toc-number">9.</span> <span class="toc-text">9、封装好的异常类而不使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结"><span class="toc-number">10.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">YB-Chi</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">49</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">24</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://osapnihnq.bkt.clouddn.com/blog/180428/0GDEA8hFH0.jpg?imageslim)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">YB-Chi</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">Java 异常处理的 9 个最佳实践</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-02</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><p>==作者：YB-Chi==</p>
<p>[toc]</p>
<p>在 Java 中，异常处理是个很麻烦的事情。初学者觉得它很难理解，甚至是经验丰富的开发者也要花费很长时间决定异常是要处理掉和抛出。</p>
<p>所以很多开发团队约定一些原则处理异常。如果你是一个团队的新成员，你可能会很惊讶，因为他们约定的规则可能和你以前使用的规则不一样。</p>
<p>不过，有很多最佳实践的规则，被大部分团队接受。这里有 9 大重要的约定，帮助你学习或者改进异常处理。</p>
<hr>
<h4 id="1、在-Finally-清理资源或者使用-Try-With-Resource-特性"><a href="#1、在-Finally-清理资源或者使用-Try-With-Resource-特性" class="headerlink" title="1、在 Finally 清理资源或者使用 Try-With-Resource 特性"></a><strong>1、在 Finally 清理资源或者使用 Try-With-Resource 特性</strong></h4><p>大部分情况下，在 try 代码块中使用资源后需要关闭资源，例如 <em>InputStream 。</em>在这些情况下，一种常见的失误就是在 try 代码块的最后关闭资源。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/d4lgFlj12g.png?imageslim" alt="mark"></p>
<p>问题就是，只有没有异常抛出的时候，这段代码才可以正常工作。try 代码块内代码会正常执行，并且资源可以正常关闭。但是，使用 try 代码块是有原因的，一般调用一个或多个可能抛出异常的方法，而且，你自己也可能会抛出一个异常，这意味着代码可能不会执行到 try 代码块的最后部分。结果就是，你并没有关闭资源。</p>
<p>所以，你应该把清理工作的代码放到 finally 里去，或者使用 try-with-resource 特性。</p>
<p>与前面几行 try 代码块不同，finally 代码块总是会被执行。不管 try 代码块成功执行之后还是你在 catch 代码块中处理完异常后都会执行。因此，你可以确保你清理了所有打开的资源。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/9Cggk2041E.png?imageslim" alt="mark"></p>
<h5 id="Java-7-的-Try-With-Resource-语法"><a href="#Java-7-的-Try-With-Resource-语法" class="headerlink" title="Java 7 的 Try-With-Resource 语法"></a><strong>Java 7 的 Try-With-Resource 语法</strong></h5><p>另一个可选的方案是 try-with-resource 语法，我在<a href="https://stackify.com/specify-handle-exceptions-java/#tryWithResource" target="_blank" rel="noopener">介绍 Java 的异常处理</a>里更详细的介绍了它。</p>
<p>如果你的资源实现了 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/AutoCloseable.html" target="_blank" rel="noopener">AutoCloseable</a> 接口，你可以使用这个语法。大多数的 Java 标准资源都继承了这个接口。当你在 try 子句中打开资源，资源会在 try 代码块执行后或异常处理后自动关闭。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/m13dDJEF60.png?imageslim" alt="mark"></p>
<h4 id="2、优先明确异常"><a href="#2、优先明确异常" class="headerlink" title="2、优先明确异常"></a><strong>2、优先明确异常</strong></h4><p>你抛出的异常越明确越好，永远记住，你的同事或者几个月之后的你，将会调用你的方法并且处理异常。</p>
<p>因此需要保证提供给他们尽可能多的信息。这样你的 API 更容易被理解。你的方法的调用者能够更好的处理异常并且避免<a href="https://stackify.com/top-java-software-errors/" target="_blank" rel="noopener">额外的检查</a>。</p>
<p>因此，总是尝试寻找最适合你的异常事件的类，例如，抛出一个 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/NumberFormatException.html" target="_blank" rel="noopener">NumberFormatException</a> 来替换一个 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html" target="_blank" rel="noopener">IllegalArgumentException</a> 。避免抛出一个不明确的异常。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/bFIaFglGCb.png?imageslim" alt="mark"></p>
<h4 id="3、记录指定的异常"><a href="#3、记录指定的异常" class="headerlink" title="3、记录指定的异常"></a><strong>3、记录指定的异常</strong></h4><p>每当你在方法签名中<a href="https://stackify.com/specify-handle-exceptions-java/#specify" target="_blank" rel="noopener">指定异常</a>，你也应该在 <a href="http://blog.joda.org/2012/11/javadoc-coding-standards.html" target="_blank" rel="noopener">Javadoc 中记录它</a>。 这与上一个最佳实践具有相同的目标：尽可能多地向调用者提供信息，以便避免或处理异常。</p>
<p>因此，请确保向 Javadoc 添加 @throws 声明并描述可能导致异常的情况。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/aAJIGJA16D.png?imageslim" alt="mark"></p>
<h4 id="4、使用描述性消息抛出异常"><a href="#4、使用描述性消息抛出异常" class="headerlink" title="4、使用描述性消息抛出异常"></a><strong>4、使用描述性消息抛出异常</strong></h4><p>这个最佳实践背后的想法与前两个类似。但这一次，你不会将信息提供给方法的调用者。每个必须了解在日志文件或监视工具中报告异常情况时发生了什么情况的人都可以读取异常消息。</p>
<p>因此，应该尽可能精确地描述问题，并提供最相关的信息来了解异常事件。</p>
<p>不要误会我的意思，你不用去写一段文字。但你也应该在1-2个短句中解释异常的原因。这有助于你的运营团队了解问题的严重性，并且还可以让你更轻松地分析任何服务突发事件。</p>
<p>如果抛出一个特定的异常，它的类名很可能已经描述了这种错误。所以，你不需要提供很多额外的信息。一个很好的例子是 NumberFormatException 。当你以错误的格式提供 String 时，它将被 java.lang.Long 类的构造函数抛出。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/HfBLkJB8ii.png?imageslim" alt="mark"></p>
<p>NumberFormatException 类的名称已经告诉你这种问题。它的消息表示只需要提供导致问题的输入字符串。如果异常类的名称不具有表达性，则需要在消息中提供所需的信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">17</span>:<span class="number">26</span>,<span class="number">386</span> ERROR TestExceptionHandling:<span class="number">52</span> - java.lang.NumberFormatException: For input string: <span class="string">"xyz"</span></span><br></pre></td></tr></table></figure>
<h4 id="5、优先捕获最具体的异常"><a href="#5、优先捕获最具体的异常" class="headerlink" title="5、优先捕获最具体的异常"></a><strong>5、优先捕获最具体的异常</strong></h4><p>大多数 IDE 都可以帮助你实现这个最佳实践。当你尝试首先捕获较不具体的异常时，它们会报告无法访问的代码块。</p>
<p>但问题在于，只有匹配异常的第一个 catch 块会被执行。 因此，如果首先捕获 IllegalArgumentException ，则永远不会到达应该处理更具体的 NumberFormatException 的 catch 块，因为它是 IllegalArgumentException 的子类。</p>
<p>总是优先捕获最具体的异常类，并将不太具体的 catch 块添加到列表的末尾。</p>
<p>你可以在下面的代码片断中看到这样一个 try-catch 语句的例子。 第一个 catch 块处理所有 NumberFormatException 异常，第二个处理所有非 NumberFormatException 异常的  IllegalArgumentException 异常。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/bH44h3mG59.png?imageslim" alt="mark"></p>
<h4 id="6、不要捕获-Throwable-类"><a href="#6、不要捕获-Throwable-类" class="headerlink" title="6、不要捕获 Throwable 类"></a><strong>6、不要捕获 Throwable 类</strong></h4><p><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Throwable.html" target="_blank" rel="noopener">Throwable</a><em> </em>是所有异常和错误的超类。你可以在 catch 子句中使用它，但是你永远不应该这样做！</p>
<p>如果在 catch 子句中使用 Throwable ，它不仅会捕获所有异常，也将捕获所有的错误。JVM 抛出错误，指出不应该由应用程序处理的严重问题。 典型的例子是 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/OutOfMemoryError.html" target="_blank" rel="noopener">OutOfMemoryError</a> 或者 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/StackOverflowError.html" target="_blank" rel="noopener">StackOverflowError</a> 。 两者都是由应用程序控制之外的情况引起的，无法处理。</p>
<p>所以，最好不要捕获 Throwable ，除非你确定自己处于一种特殊的情况下能够处理错误。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/28LK4B0Jbh.png?imageslim" alt="mark"></p>
<h4 id="7、不要忽略异常"><a href="#7、不要忽略异常" class="headerlink" title="7、不要忽略异常"></a><strong>7、不要忽略异常</strong></h4><p>你曾经有去分析过一个只执行了你用例的第一部分的 bug 报告吗？</p>
<p>这通常是由于一个被忽略的异常造成的。开发者可能会非常肯定，它永远不会被抛出，并添加一个 catch 块，不做处理或不记录它。而当你发现这个块时，你很可能甚至会发现其中有一个“这永远不会发生”的注释。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/i8m6cIEAc9.png?imageslim" alt="mark"></p>
<p>那么，你可能正在分析一个不可能发生的问题。</p>
<p>所以，请不要忽略任何一个异常。 你不知道代码将来如何改变。有人可能会在没有意识到会造成问题的情况下，删除阻止异常事件的验证。或者是抛出异常的代码被改变，现在抛出同一个类的多个异常，而调用的代码并不能阻止所有异常。</p>
<p>你至少应该写一条日志信息，告诉大家这个不可思议的事发生了，而且有人需要检查它。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/d5C2DGjCfH.png?imageslim" alt="mark"></p>
<h4 id="8、不要记录日志和抛出错误"><a href="#8、不要记录日志和抛出错误" class="headerlink" title="8、不要记录日志和抛出错误"></a><strong>8、不要记录日志和抛出错误</strong></h4><p>这可能是该文章中最常被忽略的最佳实践。 你可以找到很多的其中有一个异常被捕获的代码片段，甚至是一些代码库，被记录和重新抛出。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/EKH0A37J30.png?imageslim" alt="mark"></p>
<p>在发生异常时记录异常可能会感觉很直观，然后重新抛出异常，以便调用者可以适当地处理异常。但它会为同一个异常重复写入多个错误消息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">44</span>:<span class="number">28</span>,<span class="number">945</span> ERROR TestExceptionHandling:<span class="number">65</span> - java.lang.NumberFormatException: For input string: <span class="string">"xyz"</span></span><br><span class="line">Exception in thread <span class="string">"main"</span> java.lang.NumberFormatException: For input string: <span class="string">"xyz"</span></span><br><span class="line">at java.lang.NumberFormatException.forInputString(NumberFormatException.java:<span class="number">65</span>)</span><br><span class="line">at java.lang.Long.parseLong(Long.java:<span class="number">589</span>)</span><br><span class="line">at java.lang.Long.(Long.java:<span class="number">965</span>)</span><br><span class="line">at com.stackify.example.TestExceptionHandling.logAndThrowException(TestExceptionHandling.java:<span class="number">63</span>)</span><br><span class="line">at com.stackify.example.TestExceptionHandling.main(TestExceptionHandling.java:<span class="number">58</span>)</span><br></pre></td></tr></table></figure>
<p>附加消息也不会添加任何信息。正如在最佳实践＃4中所解释的那样，异常消息应该描述异常事件。 堆栈跟踪告诉你在哪个类，方法和行中抛出异常。</p>
<p>如果你需要添加其他信息，则应该捕获异常并将其包装在自定义的信息中。 但请务必遵循最佳实践9。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/LdgLJB9G29.png?imageslim" alt="mark"></p>
<p>所以，只捕获你想处理的异常。 否则，在方法签名中指定它，并让调用者处理它。</p>
<h4 id="9、封装好的异常类而不使用"><a href="#9、封装好的异常类而不使用" class="headerlink" title="9、封装好的异常类而不使用"></a><strong>9、封装好的异常类而不使用</strong></h4><p>有时候，最好是捕获一个标准异常并将其封装成一定制的异常。一个典型的例子是应用程序或框架特定的业务异常。允许你添加些额外的信息，并且你也可以为你的异常类实现一个特殊的处理。</p>
<p>在你这样做时，请确保将原始异常设置为原因（注：参考下方代码 NumberFormatException e 中的原始异常 e ）。<em>Exception </em>类提供了特殊的构造函数方法，它接受一个 <em>Throwable </em>作为参数。另外，你将会丢失堆栈跟踪和原始异常的消息，这将会使分析导致异常的异常事件变得困难。</p>
<p><img src="http://osapnihnq.bkt.clouddn.com/blog/180308/B37m2l50ga.png?imageslim" alt="mark"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>如你所见，当你抛出或捕获异常的时候，有很多不同的事情需要考虑，而且大部分事情都是为了改善代码的可读性或者 API 的可用性。</p>
<p>异常通常都是一种异常处理技巧，同时也是一种通信媒介。因此，为了和同事更好的合作，一个团队必须要制定出一个最佳实践和规则，只有这样团队成员才能理解这些通用概念，同时在工作中使用它。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">YB-Chi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/05/02/Java 异常处理的 9 个最佳实践/">http://yoursite.com/2018/05/02/Java 异常处理的 9 个最佳实践/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Code/">Code</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/05/02/J.U.C-原子操作/"><i class="fa fa-chevron-left">  </i><span>J.U.C-原子操作</span></a></div><div class="next-post pull-right"><a href="/2018/05/02/CentOS 6.7yum安装Mysql/"><span>CentOS 6.7yum安装mysql</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2018 By YB-Chi</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script></body></html>